// xgui.js r0 - https://github.com/oosmoxiecode/xgui.js
var xgui=function(j){void 0==j&&(j={});var g,k,a,h=[],n=!1,i=null,e=j.backgroundColor||"rgb(100, 100, 100)",f=j.frontColor||"rgb(230, 230, 230)",l=j.dimColor||"rgb(140, 140, 140)",m;this.width=j.width||600;this.height=j.height||400;g=document.createElement("div");g.style.position="relative";g.style.width=""+this.width+"px";g.style.height=""+this.height+"px";g.setAttribute("id","xgui_container");k=document.createElement("canvas");k.width=this.width;k.height=this.height;a=k.getContext("2d");g.appendChild(k);
document.addEventListener("mousemove",function(a){a.preventDefault();if(n)a=k.relMouseCoords(a),b=h[i],"CheckBox"==b.name||"RadioButton"==b.name||"Button"==b.name||"ImageButton"==b.name||"Matrix"==b.name||"Stepper"==b.name&&(b.mouseDownPlus||b.mouseDownMinus)||b.mouseDown(a.x-b.x,a.y-b.y);else if(null!=i){var b=h[i];"ColorPicker2"==b.name&&(a=k.relMouseCoords(a),b.mouseMove(a.x-b.x,a.y-b.y))}},!1);g.addEventListener("mousedown",function(a){if(a.target==g||a.target==k)null!=i?"InputText"!=h[i].name&&
"DropDown"!=h[i].name&&a.preventDefault():a.preventDefault();for(var b=k.relMouseCoords(a),c=0;c<h.length;++c)if(a=h[c],b.x>a.x&&b.x<a.x+a.width&&b.y>a.y&&b.y<a.y+a.height){a.mouseDown(b.x-a.x,b.y-a.y);n=!0;null!=i&&(b=h[i],"ColorPicker2"==b.name&&b.mouseUp());i=a.id;break}},!1);document.addEventListener("mouseup",function(){n=!1;null!=i&&h[i].mouseUp()},!1);Base=function b(a){this.constructor!=b&&(void 0==a&&(a={}),this.id=h.push(this)-1,this.x=a.x||0,this.y=a.y||0,this.updateInterval=a.updateInterval||
200,this.lastUpdate=0)};Value=function(b){this.v=b;this.bindArray=[];this.both=this.receiver=!1};Value.prototype.bind=function(){var b=arguments[0];if("function"==typeof b)this.bindArray.push(b);else if("object"==typeof b){for(var b=[b],a=1;a<arguments.length;++a)b.push(arguments[a]);this.bindArray.push(b)}else console.log("error")};Value.prototype.updateBind=function(b){for(var b=b||!1,a=0;a<this.bindArray.length;++a){var d=this.bindArray[a];if("function"==typeof d)d(this.v,b);else if("object"==
typeof d)for(var e=d[0],f=1;f<d.length;++f)this.receiver?this.v=e[d[f]]:(this.both&&(this.v=e[d[f]]),e[d[f]]=this.v);else console.log("error")}};this.Matrix=function(b){Base.call(this,b);this.name="Matrix";this.w=b.w||4;this.h=b.h||4;this.size=b.size||10;this.width=this.w*this.size+this.w-1;this.height=this.h*this.size+this.h-1;for(var a=[],d=0;d<this.h;++d){a[d]=[];for(var e=0;e<this.w;++e)a[d][e]=0}this.value=new Value(b.array||a);this.draw()};this.Matrix.prototype=new Base;this.Matrix.prototype.constructor=
this.Matrix;this.Matrix.prototype.draw=function(){a.clearRect(this.x,this.y,this.width,this.height);for(var b=0;b<this.h;++b)for(var c=0;c<this.w;++c)a.fillStyle=e,a.fillRect(this.x+c*this.size+c,this.y+b*this.size+b,this.size,this.size),this.value.v[b][c]&&(a.fillStyle=f,a.fillRect(this.x+c*this.size+c+2,this.y+b*this.size+b+2,this.size-4,this.size-4))};this.Matrix.prototype.mouseDown=function(b,a){var d=Math.floor(b/(this.size+1)),e=Math.floor(a/(this.size+1));this.value.v[e][d]=this.value.v[e][d]?
0:1;this.value.updateBind();this.draw()};this.Matrix.prototype.mouseUp=function(){this.value.updateBind(!0)};this.RangeSlider=function(b){Base.call(this,b);this.name="RangeSlider";this.mouseIsOver=!1;this.value1=new Value(b.value1||25);this.value2=new Value(b.value2||75);this.width=b.width||100;this.height=b.height||10;this.min=b.min||0;this.max=b.max||this.width;this.range=this.max-this.min;this.decimals=b.decimals||0;this.draw()};this.RangeSlider.prototype=new Base;this.RangeSlider.prototype.constructor=
this.RangeSlider;this.RangeSlider.prototype.draw=function(){this.value1.v>this.max&&(this.value1.v=this.max);this.value1.v<this.min&&(this.value1.v=this.min);this.value2.v>this.max&&(this.value2.v=this.max);this.value2.v<this.min&&(this.value2.v=this.min);this.value1.v>this.value2.v&&(this.value1.v=this.value2.v);this.value2.v<this.value1.v&&(this.value2.v=this.value1.v);a.clearRect(this.x,this.y,this.width,this.height);a.fillStyle=e;a.fillRect(this.x,this.y,this.width,this.height);var b=Math.round(0.5*
Math.max(0,this.height-11));a.fillStyle=f;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.value1.v.toFixed(this.decimals),this.x,this.y+9+b);a.fillStyle=f;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="right";a.fillText(this.value2.v.toFixed(this.decimals),this.x+this.width-1,this.y+9+b);a.fillStyle=f;var c=this.getPositionFromValue(this.value1.v),d=this.getPositionFromValue(this.value2.v);a.fillRect(this.x+c,this.y,d-c,this.height);a.save();a.fillStyle=
"transparent";a.beginPath();a.rect(this.x+c,this.y,d-c,this.height);a.clip();a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.value1.v.toFixed(this.decimals),this.x,this.y+9+b);a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="right";a.fillText(this.value2.v.toFixed(this.decimals),this.x+this.width-1,this.y+9+b);a.restore()};this.RangeSlider.prototype.setValueFromPosition=function(b,a){var d=this.range/this.width*b-(this.range-
this.max);d>this.max&&(d=this.max);d<this.min&&(d=this.min);1==a?this.value1.v=d:this.value2.v=d};this.RangeSlider.prototype.getPositionFromValue=function(a){var c=this.width/this.range,d=Math.abs(this.min);0<this.min&&(d*=-1);return c*(a+d)};this.RangeSlider.prototype.mouseDown=function(a){var c=this.getPositionFromValue(this.value1.v),d=this.getPositionFromValue(this.value2.v),c=Math.abs(a-c),d=Math.abs(a-d);c<d?(this.setValueFromPosition(a,1),this.value1.updateBind()):(this.setValueFromPosition(a,
2),this.value2.updateBind());this.draw()};this.RangeSlider.prototype.mouseUp=function(){this.value.updateBind(!0)};this.DropDown=function(a){Base.call(this,a);this.name="DropDown";this.values=a.values||["DropDown"];this.texts=a.texts||this.values;this.dropdown=document.createElement("select");this.dropdown.setAttribute("id",this.id);this.value=new Value(this.values[0]);for(a=0;a<this.values.length;++a){var c=document.createElement("option");c.text=this.texts[a];c.value=this.values[a];this.dropdown.options.add(c)}a=
document.createElement("canvas");a.width=16;a.height=16;c=a.getContext("2d");c.clearRect(0,0,16,16);c.fillStyle=l;c.fillRect(0,0,16,16);c.fillStyle=f;c.beginPath();c.moveTo(4.5,6);c.lineTo(12.5,6);c.lineTo(8.5,11);c.lineTo(4.5,6);c.closePath();c.fill();c.strokeStyle=e;c.beginPath();c.moveTo(0,0);c.lineTo(0,16);c.closePath();c.stroke();c.beginPath();c.moveTo(16,0);c.lineTo(16,16);c.closePath();c.stroke();this.div=document.createElement("div");this.div.setAttribute("id","input"+this.id);this.div.style.position=
"absolute";this.div.style.overflow="hidden";this.div.style.left=this.x-1+"px";this.div.style.top=this.y-1+"px";this.div.style.width="101px";this.div.style.height="16px";this.div.style.background="url('"+a.toDataURL("image/png")+"') no-repeat right "+f+"";this.dropdown.style.position="absolute";this.dropdown.style.left="0px";this.dropdown.style.top="0px";this.dropdown.style.borderWidth="1px";this.dropdown.style.fontFamily="sans-serif";this.dropdown.style.fontSize="10px";this.dropdown.style.outlineStyle=
"none";this.dropdown.style.color=e;this.dropdown.style.webkitAppearance="none";this.dropdown.style.webkitBorderRadius="0px";this.dropdown.style.background="rgba(0,0,0,0)";this.dropdown.style.borderStyle="solid";this.dropdown.style.width="119px";this.dropdown.style.height="16px";this.dropdown.style.textIndent="0px";this.dropdown.style.borderLeftColor=e;this.dropdown.style.borderTopColor=e;this.dropdown.style.borderRightColor=e;this.dropdown.style.borderBottomColor=e;g.appendChild(this.div);this.div.appendChild(this.dropdown);
this.dropdown.onchange=this.onChange;this.dropdown.onfocus=this.onFocus;this.draw()};this.DropDown.prototype=new Base;this.DropDown.prototype.constructor=this.DropDown;this.DropDown.prototype.onChange=function(){var a=h[this.id];a.value.v=this.value;a.value.updateBind()};this.DropDown.prototype.onFocus=function(){i=this.id};this.DropDown.prototype.draw=function(){};this.DropDown.prototype.mouseDown=function(){};this.DropDown.prototype.mouseUp=function(){};this.InputText=function(a){Base.call(this,
a);this.name="InputText";this.text=a.text||"";this.input=document.createElement("input");this.value=new Value(this.text);this.input.value=this.value.v;this.input.type="text";this.input.setAttribute("id",this.id);this.input.style.position="absolute";this.input.style.left=this.x-1+"px";this.input.style.top=this.y-1+"px";this.input.style.borderWidth="1px";this.input.style.fontFamily="sans-serif";this.input.style.fontSize="10px";this.input.style.outlineStyle="none";this.input.style.color=e;this.input.style.backgroundColor=
f;this.input.style.borderStyle="solid";this.input.style.width="100px";this.input.style.height="12px";this.input.style.marginLeft="0px";this.input.style.textIndent="3px";this.input.style.borderLeftColor=e;this.input.style.borderTopColor=e;this.input.style.borderRightColor=e;this.input.style.borderBottomColor=e;this.input.oninput=this.onTextChange;this.input.onfocus=this.onFocus;g.appendChild(this.input);this.draw()};this.InputText.prototype=new Base;this.InputText.prototype.constructor=this.InputText;
this.InputText.prototype.draw=function(){};this.InputText.prototype.onTextChange=function(){var a=h[this.id];a.value.v=this.value;a.value.updateBind()};this.InputText.prototype.onFocus=function(){i=this.id};this.InputText.prototype.mouseDown=function(){};this.InputText.prototype.mouseUp=function(){};this.Stepper=function(a){Base.call(this,a);this.name="Stepper";this.mouseIsOver=!1;this.value=new Value(a.value||0);this.width=a.width||60;this.height=a.height||10;this.min=a.min||-1E4;this.max=a.max||
1E4;this.mouseDownPlus=this.mouseDownMinus=this.mouseDownNumber=!1;this.lastMouseY=this.lastMouseX=null;this.step=a.step||10;this.decimals=a.decimals||0;this.bx=this.width-22;this.draw()};this.Stepper.prototype=new Base;this.Stepper.prototype.constructor=this.Stepper;this.Stepper.prototype.draw=function(){this.value.v<this.min&&(this.value.v=this.min);this.value.v>this.max&&(this.value.v=this.max);a.clearRect(this.x,this.y,this.width,this.height);a.fillStyle=e;a.fillRect(this.x,this.y,this.width,
this.height);var b=Math.round(0.5*Math.max(0,this.height-11));a.fillStyle=f;this.mouseDownMinus&&(a.fillStyle=e);a.fillRect(this.x+this.bx,this.y+1,10,this.height-2);a.fillStyle=e;this.mouseDownMinus&&(a.fillStyle=f);a.fillRect(this.x+this.bx+2,this.y+4+b,6,2);a.fillStyle=f;this.mouseDownPlus&&(a.fillStyle=e);a.fillRect(this.x+this.bx+11,this.y+1,10,this.height-2);a.fillStyle=e;this.mouseDownPlus&&(a.fillStyle=f);a.fillRect(this.x+this.bx+13,this.y+4+b,6,2);a.fillRect(this.x+this.bx+15,this.y+2+b,
2,6);a.fillStyle=f;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="center";a.fillText(this.value.v.toFixed(this.decimals),this.x+this.bx/2,this.y+9+b)};this.Stepper.prototype.mouseDown=function(a,c){a<this.bx&&!this.mouseDownMinus&&!this.mouseDownPlus?(this.mouseDownNumber=!0,this.mouseDownPlus=this.mouseDownMinus=!1):a>=this.bx&&a<this.bx+11&&!this.mouseDownNumber&&!this.mouseDownPlus?(this.mouseDownMinus=!0,this.mouseDownPlus=this.mouseDownNumber=!1,this.value.v-=this.step):a>=this.bx+
11&&(!this.mouseDownNumber&&!this.mouseDownMinus)&&(this.mouseDownPlus=!0,this.mouseDownMinus=this.mouseDownNumber=!1,this.value.v+=this.step);null!=this.lastMouseX&&this.mouseDownNumber&&(this.value.v+=(a-this.lastMouseX-(c-this.lastMouseY))*this.step,this.draw());this.lastMouseX=a;this.lastMouseY=c;this.draw();this.value.updateBind()};this.Stepper.prototype.mouseUp=function(){this.mouseDownPlus=this.mouseDownMinus=this.mouseDownNumber=!1;this.lastMouseY=this.lastMouseX=null;this.value.updateBind(!0);
this.draw()};this.Graph=function(a){Base.call(this,a);this.name="Graph";this.width=a.width||100;this.height=a.height||40;this.min=a.min||0;this.max=a.max||1;this.range=this.max-this.min;this.value=new Value(this.min);this.draw()};this.Graph.prototype=new Base;this.Graph.prototype.constructor=this.Graph;this.Graph.prototype.draw=function(){this.value.v>this.max&&(this.value.v=this.max);this.value.v<this.min&&(this.value.v=this.min);var b=a.getImageData(this.x,this.y,this.width,this.height);a.clearRect(this.x,
this.y,this.width,this.height);a.strokeStyle=e;a.lineWidth=2;a.strokeRect(this.x,this.y,this.width,this.height);a.fillStyle=f;a.fillRect(this.x,this.y,this.width,this.height);a.save();a.fillStyle="transparent";a.beginPath();a.rect(this.x,this.y,this.width,this.height);a.clip();var c=document.createElement("canvas");c.width=this.width;c.height=this.height;c.getContext("2d").putImageData(b,0,0);a.drawImage(c,this.x-1,this.y);a.fillStyle=l;b=this.height/this.range*(this.value.v+Math.abs(this.min));a.fillRect(this.x+
this.width-1,this.y+this.height-b,1,b);a.restore()};this.Graph.prototype.mouseDown=function(){};this.Graph.prototype.mouseUp=function(){};this.ImageButton=function(a){Base.call(this,a);this.name="ImageButton";this.image=a.image||new Image;this.width=this.image.width;this.height=this.image.height;this.mouseIsDown=!1;this.value=new Value(this.mouseIsDown);this.draw()};this.ImageButton.prototype=new Base;this.ImageButton.prototype.constructor=this.ImageButton;this.ImageButton.prototype.draw=function(){a.clearRect(this.x,
this.y,this.width,this.height);a.globalAlpha=this.mouseIsDown?0.5:1;a.drawImage(this.image,this.x,this.y);a.globalAlpha=1};this.ImageButton.prototype.mouseDown=function(){this.mouseIsDown=!0;this.value.v=this.mouseIsDown;this.value.updateBind();this.draw()};this.ImageButton.prototype.mouseUp=function(){this.value.updateBind(!0);this.mouseIsDown=!1;this.value.v=this.mouseIsDown;this.value.updateBind();this.draw()};this.Button=function(a){Base.call(this,a);this.name="Button";this.width=this.fullWidth=
0;this.height=Math.max(a.height,14)||14;this.text=a.text||"";this.mouseIsDown=!1;this.value=new Value(this.mouseIsDown);this.draw();this.draw()};this.Button.prototype=new Base;this.Button.prototype.constructor=this.Button;this.Button.prototype.draw=function(){a.clearRect(this.x,this.y,this.width,this.height);a.strokeStyle=e;a.lineWidth=2;a.strokeRect(this.x,this.y,this.width,this.height);a.fillStyle=f;this.mouseIsDown&&(a.fillStyle=l);a.fillRect(this.x,this.y,this.width,this.height);var b=Math.round(0.5*
Math.max(0,this.height-14));a.fillStyle=e;this.mouseIsDown&&(a.fillStyle=f);a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.text,this.x+4,this.y+11+b);this.width=this.fullWidth+a.measureText(this.text).width+9};this.Button.prototype.mouseDown=function(){this.mouseIsDown=!0;this.value.v=this.mouseIsDown;this.value.updateBind();this.draw()};this.Button.prototype.mouseUp=function(){this.value.updateBind(!0);this.mouseIsDown=!1;this.value.v=this.mouseIsDown;this.draw()};
this.TrackPad=function(a){Base.call(this,a);this.name="TrackPad";this.width=a.width||100;this.height=a.height||60;this.min=a.min||-1;this.max=a.max||1;this.range=this.max-this.min;var c=-1*(this.range/2-this.max);this.value1=new Value(a.value1||c);this.value2=new Value(a.value2||c);this.draw()};this.TrackPad.prototype=new Base;this.TrackPad.prototype.constructor=this.TrackPad;this.TrackPad.prototype.draw=function(){this.value1.v<this.min&&(this.value1.v=this.min);this.value1.v>this.max&&(this.value1.v=
this.max);this.value2.v<this.min&&(this.value2.v=this.min);this.value2.v>this.max&&(this.value2.v=this.max);a.clearRect(this.x-1,this.y,this.width,this.height+14);a.strokeStyle=e;a.lineWidth=2;a.strokeRect(this.x,this.y,this.width,this.height);a.fillStyle=f;a.fillRect(this.x,this.y,this.width,this.height);a.strokeStyle=l;a.lineWidth=1;a.beginPath();a.moveTo(this.x,0.5+this.y+this.height/2);a.lineTo(this.x+this.width,0.5+this.y+this.height/2);a.closePath();a.stroke();a.beginPath();a.moveTo(0.5+this.x+
this.width/2,this.y);a.lineTo(0.5+this.x+this.width/2,this.y+this.height);a.closePath();a.stroke();var b=this.getXPositionFromValue(),c=this.getYPositionFromValue();3>b&&(b=3);b>this.width-3&&(b=this.width-3);3>c&&(c=3);c>this.height-3&&(c=this.height-3);a.fillStyle=l;a.fillRect(this.x+b-3,this.y+c-3,7,7);a.fillStyle=e;a.font="8px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText("X: "+this.value1.v.toFixed(2)+" Y: "+this.value2.v.toFixed(2),this.x,this.y+this.height+9)};this.TrackPad.prototype.setXValueFromPosition=
function(a){this.value1.v=this.range/this.width*a-(this.range-this.max)};this.TrackPad.prototype.setYValueFromPosition=function(a){this.value2.v=this.range/this.height*a-(this.range-this.max)};this.TrackPad.prototype.getXPositionFromValue=function(){var a=this.width/this.range,c=Math.abs(this.min);0<this.min&&(c*=-1);return a*(this.value1.v+c)};this.TrackPad.prototype.getYPositionFromValue=function(){var a=this.height/this.range,c=Math.abs(this.min);0<this.min&&(c*=-1);return a*(this.value2.v+c)};
this.TrackPad.prototype.mouseDown=function(a,c){this.setXValueFromPosition(a);this.setYValueFromPosition(c);this.draw();this.value1.updateBind();this.value2.updateBind()};this.TrackPad.prototype.mouseUp=function(){this.value.updateBind(!0)};this.ColorPicker2=function(a){Base.call(this,a);this.name="ColorPicker2";this.framewidth=a.framewidth||10;this.frameheight=a.frameheight||10;this.colorwidth=a.width||100;this.colorheight=a.height||30;this.width=this.framewidth;this.height=this.frameheight;this.r=
a.r||255;this.g=a.g||255;this.b=a.b||255;this.oldColor={r:this.r,g:this.g,b:this.b};this.mousehack=this.open=!1;this.lastTime=0;this.hex=a.hex||colorToHex("rgb("+this.r+","+this.g+","+this.b+")");this.value=new Value(this.hex);this.draw()};this.ColorPicker2.prototype=new Base;this.ColorPicker2.prototype.constructor=this.ColorPicker2;this.ColorPicker2.prototype.draw=function(){a.clearRect(this.x-1,this.y-1,this.framewidth+60,this.height+3);a.clearRect(this.x-1,this.y+this.frameheight,this.colorwidth+
2,this.colorheight+3);a.strokeStyle=e;a.lineWidth=2;a.strokeRect(this.x,this.y,this.framewidth,this.frameheight);a.fillStyle="#"+this.value.v;a.fillRect(this.x,this.y,this.framewidth,this.frameheight);var b=Math.round(0.5*Math.max(0,this.frameheight-11));a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText("#"+this.value.v.toUpperCase(),this.x+this.framewidth+4,this.y+9+b);if(this.open){a.strokeStyle=e;a.lineWidth=2;a.strokeRect(this.x,this.y+this.frameheight+
1,this.colorwidth,this.colorheight);var b=a.createLinearGradient(this.x,this.y+this.frameheight+1,this.x+this.colorwidth,this.y+this.frameheight+1),c=1/6,d=0;b.addColorStop(c*d++,"rgb(255, 0, 0)");b.addColorStop(c*d++,"rgb(255, 255, 0)");b.addColorStop(c*d++,"rgb(0, 255, 0)");b.addColorStop(c*d++,"rgb(0, 255, 255)");b.addColorStop(c*d++,"rgb(0, 0, 255)");b.addColorStop(c*d++,"rgb(255, 0, 255)");b.addColorStop(c*d++,"rgb(255, 0, 0)");a.fillStyle=b;a.fillRect(this.x,this.y+this.frameheight+1,this.colorwidth,
this.colorheight);c=1/(this.colorheight/2);b=a.createLinearGradient(this.x,this.y+this.frameheight+1,this.x,this.y+this.frameheight+1+this.colorheight/2);b.addColorStop(0,"rgba(255, 255, 255, 1)");b.addColorStop(c,"rgba(255, 255, 255, 1)");b.addColorStop(1,"rgba(255, 255, 255, 0)");a.fillStyle=b;a.fillRect(this.x,this.y+this.frameheight+1,this.colorwidth,this.colorheight/2);b=a.createLinearGradient(this.x,this.y+this.frameheight+1+this.colorheight/2,this.x,this.y+this.frameheight+1+this.colorheight);
b.addColorStop(0,"rgba(0, 0, 0, 0)");b.addColorStop(1-c,"rgba(0, 0, 0, 1)");b.addColorStop(1,"rgba(0, 0, 0, 1)");a.fillStyle=b;a.fillRect(this.x,this.y+this.frameheight+1+this.colorheight/2,this.colorwidth,this.colorheight/2)}};this.ColorPicker2.prototype.mouseDown=function(a,c){if(!(200>(new Date).getTime()-this.lastTime)&&(this.open&&(0<a&&a<this.colorwidth-1&&c>this.frameheight&&c<this.frameheight+this.colorheight)&&(this.oldColor={r:this.r,g:this.g,b:this.b}),!this.open&&c<this.frameheight?this.open=
!0:this.open&&(this.open=!1),this.open?(this.width=this.colorwidth,this.height=this.frameheight+this.colorheight):(this.width=this.framewidth,this.height=this.frameheight),this.draw(),this.mousehack=!1,this.lastTime=(new Date).getTime(),!this.open))for(var d=0;d<h.length;++d)h[d].draw()};this.ColorPicker2.prototype.setOldColor=function(){this.r=this.oldColor.r;this.g=this.oldColor.g;this.b=this.oldColor.b;this.hex=colorToHex("rgb("+this.r+","+this.g+","+this.b+")")};this.ColorPicker2.prototype.mouseMove=
function(b,c){var d=!1;0>b&&(b=0,this.setOldColor(),d=!0);b>this.colorwidth-1&&(b=this.colorwidth-1,this.setOldColor(),d=!0);c<=this.frameheight&&(c=this.frameheight,this.setOldColor(),d=!0);c>this.frameheight+this.colorheight&&(c=this.frameheight+this.colorheight,this.setOldColor(),d=!0);d||(d=a.getImageData(this.x+b,this.y+c,1,1).data,this.r=d[0],this.g=d[1],this.b=d[2],this.hex=colorToHex("rgb("+this.r+","+this.g+","+this.b+")"));this.value.v=this.hex;this.value.updateBind();this.draw()};this.ColorPicker2.prototype.mouseUp=
function(){this.open||(i=null);this.mousehack&&(this.setOldColor(),this.mouseDown(),i=null);this.mousehack=!0;this.value.updateBind(!0)};this.ColorPicker=function(a){Base.call(this,a);this.name="ColorPicker";this.framewidth=a.framewidth||10;this.frameheight=a.frameheight||10;this.width=a.width||100;this.height=a.height||20;this.r=a.r||255;this.g=a.g||255;this.b=a.b||255;this.hex=a.hex||colorToHex("rgb("+this.r+","+this.g+","+this.b+")");this.value=new Value(this.hex);this.draw()};this.ColorPicker.prototype=
new Base;this.ColorPicker.prototype.constructor=this.ColorPicker;this.ColorPicker.prototype.draw=function(){a.clearRect(this.x,this.y,this.width,this.height+this.frameheight+4);a.strokeStyle=e;a.lineWidth=2;a.strokeRect(this.x,this.y,this.width,this.height);var b=a.createLinearGradient(this.x,this.y,this.x+this.width,this.y),c=1/6,d=0;b.addColorStop(c*d++,"rgb(255, 0, 0)");b.addColorStop(c*d++,"rgb(255, 255, 0)");b.addColorStop(c*d++,"rgb(0, 255, 0)");b.addColorStop(c*d++,"rgb(0, 255, 255)");b.addColorStop(c*
d++,"rgb(0, 0, 255)");b.addColorStop(c*d++,"rgb(255, 0, 255)");b.addColorStop(c*d++,"rgb(255, 0, 0)");a.fillStyle=b;a.fillRect(this.x,this.y,this.width,this.height);c=1/(this.height/2);b=a.createLinearGradient(this.x,this.y,this.x,this.y+this.height/2);b.addColorStop(0,"rgba(255, 255, 255, 1)");b.addColorStop(c,"rgba(255, 255, 255, 1)");b.addColorStop(1,"rgba(255, 255, 255, 0)");a.fillStyle=b;a.fillRect(this.x,this.y,this.width,this.height/2);b=a.createLinearGradient(this.x,this.y+this.height/2,this.x,
this.y+this.height);b.addColorStop(0,"rgba(0, 0, 0, 0)");b.addColorStop(1-c,"rgba(0, 0, 0, 1)");b.addColorStop(1,"rgba(0, 0, 0, 1)");a.fillStyle=b;a.fillRect(this.x,this.y+this.height/2,this.width,this.height/2);a.strokeStyle=e;a.lineWidth=2;a.strokeRect(this.x,this.y+this.height+4,this.framewidth,this.frameheight);a.fillStyle="#"+this.value.v;a.fillRect(this.x,this.y+this.height+4,this.framewidth,this.frameheight);b=Math.round(0.5*Math.max(0,this.frameheight-10));a.fillStyle=e;a.font="11px Arial";
a.textBaseline="alphabetic";a.textAlign="left";a.fillText("#"+this.value.v.toUpperCase(),this.x+this.framewidth+4,this.y+this.height+13+b)};this.ColorPicker.prototype.mouseDown=function(b,c){0>b&&(b=0);b>this.width-1&&(b=this.width-1);0>c&&(c=0);c>this.height-1&&(c=this.height-1);var d=a.getImageData(this.x+b,this.y+c,1,1).data;this.r=d[0];this.g=d[1];this.b=d[2];this.hex=colorToHex("rgb("+this.r+","+this.g+","+this.b+")");this.value.v=this.hex;this.value.updateBind();this.draw()};this.ColorPicker.prototype.mouseUp=
function(){this.value.updateBind(!0)};this.Knob=function(a){Base.call(this,a);this.name="Knob";this.radius=a.radius||15;this.centerx=this.x+this.radius;this.centery=this.y+this.radius;this.width=2*this.radius;this.height=2*this.radius;this.min=a.min||0;this.max=a.max||100;this.range=this.max-this.min;this.value=new Value(a.value||0);this.rotationValue=this.getRotationValue();this.lastMouseY=this.lastMouseX=null;this.decimals=a.decimals||0;this.draw()};this.Knob.prototype=new Base;this.Knob.prototype.constructor=
this.Knob;this.Knob.prototype.getRotationValue=function(){return(this.value.v-this.min)*(1/this.range)};this.Knob.prototype.draw=function(){this.value.v<this.min&&(this.value.v=this.min);this.value.v>this.max&&(this.value.v=this.max);a.clearRect(this.x-4,this.y-4,this.width+8,this.height+13);a.fillStyle=e;a.beginPath();a.arc(this.centerx,this.centery,this.radius,0,2*Math.PI,!1);a.closePath();a.fill();var b=Math.PI+Math.PI/1.25,c=Math.PI-Math.PI/1.25,d=(b-c)/this.radius;a.strokeStyle=e;a.lineWidth=
0.5;for(var g=0;g<=this.radius;++g){var h=this.centerx+Math.sin(b-d*g)*(this.radius+1),i=this.centery+Math.cos(b-d*g)*(this.radius+1),j=this.centerx+Math.sin(b-d*g)*(this.radius+4),k=this.centery+Math.cos(b-d*g)*(this.radius+4);a.beginPath();a.moveTo(h,i);a.lineTo(j,k);a.closePath();a.stroke()}this.rotationValue=this.getRotationValue();d=(b-c)*this.rotationValue;c=this.centerx+Math.sin(b-d)*this.radius;b=this.centery+Math.cos(b-d)*this.radius;a.strokeStyle=f;a.lineWidth=2;a.beginPath();a.moveTo(this.centerx,
this.centery);a.lineTo(c,b);a.closePath();a.stroke();a.fillStyle=e;a.font="8px Arial";a.textBaseline="alphabetic";a.textAlign="center";a.fillText(this.value.v.toFixed(this.decimals),this.centerx,this.centery+this.radius+7)};this.Knob.prototype.mouseDown=function(a,c){if(null!=this.lastMouseX){var d=(a-this.lastMouseX-(c-this.lastMouseY))/100,d=d*this.range;this.value.v+=d;this.draw();this.value.updateBind()}this.lastMouseX=a;this.lastMouseY=c};this.Knob.prototype.mouseUp=function(){this.lastMouseY=
this.lastMouseX=null;this.value.updateBind(!0)};this.CheckBox=function(a){Base.call(this,a);this.name="CheckBox";this.text=a.text||"";this.value=new Value(a.selected||!1);this.width=this.fullWidth=a.width||10;this.height=a.height||10;this.draw()};this.CheckBox.prototype=new Base;this.CheckBox.prototype.constructor=this.CheckBox;this.CheckBox.prototype.draw=function(){a.clearRect(this.x,this.y,this.width,this.height);a.fillStyle=e;a.fillRect(this.x,this.y,this.fullWidth,this.height);a.fillStyle=this.value.v?
f:e;a.fillRect(this.x+2,this.y+2,this.fullWidth-4,this.height-4);var b=Math.round(0.5*Math.max(0,this.height-11));a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.text,this.x+this.fullWidth+2,this.y+9+b);this.width=this.fullWidth+a.measureText(this.text).width+3};this.CheckBox.prototype.mouseDown=function(){this.value.v=this.value.v?!1:!0;this.value.updateBind();this.draw()};this.CheckBox.prototype.mouseUp=function(){this.value.updateBind(!0)};this.RadioButtonGroup=
function(){this.name="RadioButtonGroup";this.array=[];this.value=new Value([])};this.RadioButtonGroup.prototype.add=function(a){this.array.push(a);this.value.v.push(a.value.v);a.group=this};this.RadioButtonGroup.prototype.clear=function(a){for(var c=0;c<this.array.length;++c){var d=this.array[c];d==a?this.value.v[c]=!0:(this.value.v[c]=!1,d.value.v=!1,d.value.updateBind(),d.draw())}this.value.updateBind()};this.RadioButton=function(a){Base.call(this,a);this.name="RadioButton";this.group=null;this.text=
a.text||"";this.value=new Value(a.selected||!1);this.width=this.fullWidth=a.width||18;this.height=a.height||10;this.draw()};this.RadioButton.prototype=new Base;this.RadioButton.prototype.constructor=this.RadioButton;this.RadioButton.prototype.draw=function(){a.clearRect(this.x,this.y,this.width,this.height);a.fillStyle=e;a.fillRect(this.x,this.y,this.fullWidth,this.height);this.value.v?(a.fillStyle=f,a.fillRect(this.x+this.fullWidth/2+1,this.y+2,this.fullWidth/2-3,this.height-4)):(a.fillStyle=l,a.fillRect(this.x+
2,this.y+2,this.fullWidth/2-3,this.height-4));var b=Math.round(0.5*Math.max(0,this.height-11));a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.text,this.x+this.fullWidth+2,this.y+9+b);this.width=this.fullWidth+a.measureText(this.text).width+3};this.RadioButton.prototype.mouseDown=function(){this.group.clear(this);this.value.v||(this.value.v=!0);this.value.updateBind();this.draw()};this.RadioButton.prototype.mouseUp=function(){this.value.updateBind(!0)};
this.RadioButton.prototype.mouseMove=function(){};this.HSlider=function(a){Base.call(this,a);this.name="HSlider";this.mouseIsOver=!1;this.value=new Value(a.value||0);this.width=a.width||100;this.height=a.height||10;this.min=a.min||0;this.max=a.max||this.width;this.range=this.max-this.min;this.decimals=a.decimals||0;this.draw()};this.HSlider.prototype=new Base;this.HSlider.prototype.constructor=this.HSlider;this.HSlider.prototype.draw=function(){this.value.v>this.max&&(this.value.v=this.max);this.value.v<
this.min&&(this.value.v=this.min);a.clearRect(this.x,this.y,this.width,this.height);a.fillStyle=e;a.fillRect(this.x,this.y,this.width,this.height);var b=Math.round(0.5*Math.max(0,this.height-11));a.fillStyle=f;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.value.v.toFixed(this.decimals),this.x,this.y+9+b);var c=this.getPositionFromValue();a.fillStyle=f;a.fillRect(this.x,this.y,c,this.height);a.save();a.fillStyle="transparent";a.beginPath();a.rect(this.x,this.y,
c,this.height);a.clip();a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.value.v.toFixed(this.decimals),this.x,this.y+9+b);a.restore()};this.HSlider.prototype.setValueFromPosition=function(a){this.value.v=this.range/this.width*a-(this.range-this.max)};this.HSlider.prototype.getPositionFromValue=function(){var a=this.width/this.range,c=Math.abs(this.min);0<this.min&&(c*=-1);return a*(this.value.v+c)};this.HSlider.prototype.mouseDown=function(a){this.setValueFromPosition(a);
this.draw();this.value.updateBind()};this.HSlider.prototype.mouseUp=function(){this.value.updateBind(!0)};this.VSlider=function(a){Base.call(this,a);this.name="VSlider";this.mouseIsOver=!1;this.value=new Value(a.value||0);this.width=a.width||10;this.height=a.height||100;this.min=a.min||0;this.max=a.max||this.height;this.decimals=a.decimals||0;this.range=this.max-this.min;this.draw()};this.VSlider.prototype=new Base;this.VSlider.prototype.constructor=this.VSlider;this.VSlider.prototype.draw=function(){this.value.v>
this.max&&(this.value.v=this.max);this.value.v<this.min&&(this.value.v=this.min);a.clearRect(this.x,this.y,this.width,this.height);a.fillStyle=e;a.fillRect(this.x,this.y,this.width,this.height);var b=Math.round(0.5*Math.max(0,this.width-11));a.save();a.translate(this.x+9+b,this.y+this.height-1);a.rotate(-Math.PI/2);a.fillStyle=f;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.value.v.toFixed(this.decimals),0,0);a.restore();var c=this.getPositionFromValue();a.fillStyle=
f;a.fillRect(this.x,this.y+c,this.width,this.height-c);a.save();a.translate(this.x+9+b,this.y+this.height-1);a.rotate(-Math.PI/2);a.fillStyle="transparent";a.beginPath();a.rect(-1,-this.width+1,this.height-c,this.width);a.clip();a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.value.v.toFixed(this.decimals),0,0);a.restore()};this.VSlider.prototype.setValueFromPosition=function(a){this.value.v=this.range-this.range/this.height*a-(this.range-this.max)};
this.VSlider.prototype.getPositionFromValue=function(){var a=this.height/this.range,c=Math.abs(this.min);0<this.min&&(c*=-1);return this.height-a*(this.value.v+c)};this.VSlider.prototype.mouseDown=function(a,c){this.setValueFromPosition(c);this.draw();this.value.updateBind()};this.VSlider.prototype.mouseUp=function(){this.value.updateBind(!0)};this.Label=function(a){Base.call(this,a);this.name="Label";this.group=null;this.value=new Value(a.text||"");this.width=0;this.height=13;this.draw()};this.Label.prototype=
new Base;this.Label.prototype.constructor=this.Label;this.Label.prototype.draw=function(){a.clearRect(this.x,this.y,this.width,this.height);a.fillStyle=e;a.font="11px Arial";a.textBaseline="alphabetic";a.textAlign="left";a.fillText(this.value.v,this.x,this.y+9);this.width=a.measureText(this.value.v).width+3};this.Label.prototype.mouseDown=function(){};this.Label.prototype.mouseUp=function(){};this.update=function(){m=Date.now();for(var a=0;a<h.length;++a){var c=h[a];if(c.value&&(c.value.receiver||
c.value.both)&&m>c.lastUpdate+c.updateInterval)c.value.updateBind(),c.draw(),c.lastUpdate=m;if(c.value1){var d=!1;if((c.value1.receiver||c.value1.both)&&m>c.lastUpdate+c.updateInterval)c.value1.updateBind(),d=!0;if((c.value2.receiver||c.value2.both)&&m>c.lastUpdate+c.updateInterval)c.value2.updateBind(),d=!0;d&&(c.draw(),c.lastUpdate=m)}}};return{getDomElement:function(){return g},getContext:function(){return a},HSlider:this.HSlider,VSlider:this.VSlider,Label:this.Label,RadioButton:this.RadioButton,
RadioButtonGroup:this.RadioButtonGroup,CheckBox:this.CheckBox,Knob:this.Knob,ColorPicker:this.ColorPicker,ColorPicker2:this.ColorPicker2,TrackPad:this.TrackPad,Button:this.Button,ImageButton:this.ImageButton,Graph:this.Graph,Stepper:this.Stepper,InputText:this.InputText,DropDown:this.DropDown,Matrix:this.Matrix,RangeSlider:this.RangeSlider,update:this.update}};
function colorToHex(j){var g=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/.exec(j);return g?(16777216|g[1]<<16|g[2]<<8|g[3]).toString(16).substr(1):j}HTMLCanvasElement.prototype.relMouseCoords=function(j){var g=0,k=0,a=0,h=0,a=this;do g+=a.offsetLeft,k+=a.offsetTop;while(a=a.offsetParent);a=j.pageX-g;h=j.pageY-k;a=Math.round(a*(this.width/this.offsetWidth));h=Math.round(h*(this.height/this.offsetHeight));return{x:a,y:h}};
